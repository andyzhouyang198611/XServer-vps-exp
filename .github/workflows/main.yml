on:
  schedule:
    - cron: 0 7,15,23 * * *
  push:
  workflow_dispatch:

jobs:
  job:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v4
      - run: sudo apt-get -qq update && sudo apt-get -yqq install --no-install-recommends ffmpeg fonts-noto-cjk
      - run: yarn add puppeteer
      - run: node main.mjs
        env:
          EMAIL: ${{ secrets.EMAIL }}
          PASSWORD: ${{ secrets.PASSWORD }}
          PROXY_SERVER: ${{ secrets.PROXY_SERVER }}
      - name: ğŸ“± å‘é€ Telegram é€šçŸ¥
        # ä¿®å¤åçš„ if è¯­æ³•ï¼šåœ¨ if å†…éƒ¨å¼•ç”¨ secrets éœ€è¦åŒ…è£¹åœ¨ ${{ }} ä¸­
        if: always()
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          # ç›´æ¥æ„å»ºå›ºå®šæ ¼å¼çš„æ¶ˆæ¯
          MESSAGE="ğŸ¢ Xserver è¿è¡Œé€šçŸ¥ï¼š
          ğŸ“… æ—¶é—´ï¼š$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')
          ğŸ“Š çŠ¶æ€ï¼š${{ job.status == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }}
          
          ğŸ“‹ è¯¦ç»†æ—¥å¿—ï¼š
          ğŸ”— ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"

          # å‘é€é€šçŸ¥
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            --data-urlencode "chat_id=${TELEGRAM_CHAT_ID}" \
            --data-urlencode "text=${MESSAGE}" \
            -d "parse_mode=Markdown"
      - uses: actions/upload-artifact@v4
        with:
          path: recording.webm
